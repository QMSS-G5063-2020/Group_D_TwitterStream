---
title: "Untitled"
author: "Lemon Reimer"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
library(rtweet)
library(ggplot2)

#points to where python is on your local
use_python("C:/Users/swagj/AppData/Local/Continuum/anaconda3/python.exe")

#sets base directory
knitr::opts_knit$set(root.dir = normalizePath("C:\\Users\\swagj\\Documents\\GitHub\\TwitterNetworkStreaming\\Lemon_Streamer_Tweepy"))
```

```{r initialize python object}
source_python("Lemon_ML.py", convert = T)
```

```{r API keys}
#after the first call, this info is saved to renviron

#ckey=""
#csecret=""
#atoken=""
#asecret=""

#token <- create_token(
  #app = "LemonAPIApp",
  #consumer_key = ckey,
  #consumer_secret = csecret,
  #access_token = atoken,
  #access_secret = asecret)
```

```{r}
query <- "COVID"
streamtime <- 2 #number of seconds for each sampling from twitter
filename <- "teststream.json"

timer <- 1 #initialize timer
rt <- stream_tweets(q = query, timeout = streamtime, file_name = filename) #initialize dataframe
rt <- rt[rt$lang == "en",] #remove non-english text

repeat { #start repeat statement
  temp_rt <- stream_tweets(q = query, timeout = streamtime, file_name = filename) #stream new data
  temp_rt <- temp_rt[temp_rt$lang == "en",] 
  rt <- rbind(rt, temp_rt) #add new data to dataframe
  timer <- timer + 1 #add loop to timer
  
  #for (tweet in temp_rt$text){ #test, ignore
    #print(tweet)
  #}
  
  #print(ggplot(rt, aes(x = source)) + geom_bar()) #example of bar plot, rescales as count increases!
  print(ts_plot(rt, by = 'secs', trim = 1)) #example of line plot, rescales as count increases!
  if (timer == 5){ #break statement, stream ends after 5 loops
    break
  }
}
```

```{r}
ts_plot(rt, by = 'secs', trim = 1)
```

